<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PsySymbol — Dream Meanings, Symbols & Numbers</title>
  <meta name="description" content="Type a dream, symbol, or number and get an instant interpretation. AI‑assisted, with optional web enrichment." />
  <link rel="canonical" href="https://psysymbol.com/" />
  <meta name="robots" content="index,follow" />

  <!-- Your verified AdSense publisher account -->
  <meta name="google-adsense-account" content="ca-pub-3857946786580406" />

  <!-- Auto ads only: we inject the AdSense script AFTER consent (with NPA support). -->
  <script>
    window.__PSY_ADS__ = {
      client: 'ca-pub-3857946786580406',
      load(params) {
        if (document.getElementById('adsbygooglejs')) return;
        const s = document.createElement('script');
        s.async = true;
        s.id = 'adsbygooglejs';
        let src = `https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${encodeURIComponent(this.client)}`;
        if (params && params.npa === 1) src += '&npa=1'; // non-personalized hint
        s.crossOrigin = 'anonymous';
        s.src = src;
        document.head.appendChild(s);
      }
    };
  </script>

  <!-- Google Consent Mode v2 (default deny) -->
  <script>
    (function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;
      gtag('consent', 'default', {
        'ad_storage': 'denied',
        'analytics_storage': 'denied',
        'ad_personalization': 'denied',
        'ad_user_data': 'denied'
      });
      gtag('set', 'url_passthrough', true);
    })();
  </script>

  <style>
    :root{
      --bg:#0b0b0e; --text:#f7f7f7; --muted:#b7b7c0; --card:#14141a; --border:#272732; --brand:#9c7bff; --accent:#24d5a1;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;background:var(--bg);color:var(--text)}
    .container{max-width:980px;margin:0 auto;padding:24px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;cursor:pointer;text-decoration:none;color:var(--text)}
    .brand .logo{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;font-weight:700}
    .brand span{font-weight:700;letter-spacing:.2px}
    nav a{color:var(--muted);text-decoration:none;margin-left:14px;font-size:14px}
    nav a:hover{color:var(--text)}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#0f0f14;color:var(--muted);cursor:pointer}
    .tab.active{color:#0b0b0e;background:var(--accent);border-color:transparent;font-weight:600}
    .controls{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .input{flex:1;min-width:220px;background:#0f0f14;border:1px solid var(--border);border-radius:10px;padding:12px;color:var(--text)}
    .btn{background:var(--brand);border:none;color:#0b0b0e;font-weight:700;padding:12px 14px;border-radius:10px;cursor:pointer}
    .btn.secondary{background:#1a1a22;color:var(--text);border:1px solid var(--border)}
    .muted{color:var(--muted);font-size:13px}
    .output{white-space:pre-wrap;line-height:1.6}
    .hr{height:1px;background:var(--border);margin:16px 0}

    footer{margin-top:32px;color:var(--muted)}
    .footer-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .footer-grid a{color:var(--muted);text-decoration:none}
    .footer-grid a:hover{color:var(--text)}

    dialog.legal{max-width:820px;width:100%;background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:14px;padding:18px}
    dialog::backdrop{background:rgba(0,0,0,.6)}

    .cookie{position:fixed;inset:auto 12px 12px 12px;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;display:none;z-index:50}
    .cookie.show{display:block}
    .cookie .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin-top:10px}

    @media (max-width:640px){ .footer-grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header class="container header">
    <a class="brand" id="brandHome" title="Reset to start">
      <div class="logo">Ψ</div>
      <span>PsySymbol</span>
    </a>
    <nav>
      <a href="#about" id="aboutLink">About</a>
      <a href="#contact" id="contactLink">Contact</a>
      <a href="#privacy" id="privacyLink">Privacy</a>
      <a href="#terms" id="termsLink">Terms</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <div class="tabs">
        <button class="tab active" data-mode="dream">Dream</button>
        <button class="tab" data-mode="symbol">Symbol</button>
        <button class="tab" data-mode="number">Number</button>
      </div>
      <div class="row">
        <input id="query" class="input" placeholder="Type your dream, symbol, or number…" />
        <button id="interpret" class="btn">Interpret</button>
        <button id="reset" class="btn secondary">Reset</button>
      </div>
      <div class="controls">
        <label class="muted"><input type="checkbox" id="enrichToggle"/> Enrich with web sources (beta)</label>
        <span class="muted">·</span>
        <label class="muted"><input type="checkbox" id="autoAdsToggle" checked /> Enable Auto ads</label>
      </div>
      <div class="hr"></div>
      <div id="result" class="output muted">Enter something above and press <b>Interpret</b>.</div>
    </section>

    <footer>
      <div class="footer-grid">
        <div>
          <div class="muted">© <span id="year"></span> PsySymbol. All rights reserved.</div>
        </div>
        <div style="text-align:right">
          <a href="#privacy">Privacy</a> · <a href="#cookie">Cookie Policy</a> · <a href="#terms">Terms</a>
        </div>
      </div>
    </footer>
  </main>

  <!-- LEGAL DIALOGS -->
  <dialog id="dlg-privacy" class="legal">
    <h3>Privacy Policy</h3>
    <p>Last updated: <span id="privacy-date"></span></p>
    <p>PsySymbol processes your inputs client‑side. When “Enrich with web sources (beta)” is enabled, public summaries may be fetched. We do not sell personal data. See Cookie Policy for ad consent details.</p>
    <form method="dialog"><button class="btn secondary">Close</button></form>
  </dialog>

  <dialog id="dlg-cookie" class="legal">
    <h3>Cookie Policy & Consent</h3>
    <p>Choose: personalized ads, non‑personalized ads, or no ads cookies.</p>
    <div class="hr"></div>
    <div class="row">
      <button id="cookieAccept" class="btn">Allow Personalized Ads</button>
      <button id="cookieNPA" class="btn secondary">Allow Non‑Personalized Ads</button>
      <button id="cookieReject" class="btn secondary">Reject Ads Cookies</button>
    </div>
    <p class="muted" style="margin-top:10px">Change anytime from the footer: <a href="#cookie">Cookie Policy</a>.</p>
    <form method="dialog"><button class="btn secondary" style="margin-top:12px">Close</button></form>
  </dialog>

  <dialog id="dlg-terms" class="legal">
    <h3>Terms of Service</h3>
    <p>Interpretations are informational and not medical, legal, or psychological advice. Don’t submit unlawful content. We may update these terms.</p>
    <form method="dialog"><button class="btn secondary">Close</button></form>
  </dialog>

  <dialog id="dlg-about" class="legal">
    <h3>About PsySymbol</h3>
    <p>PsySymbol is a single‑page tool for quick interpretations of dreams, symbols, and numbers—with optional web enrichment. No accounts, no downloads.</p>
    <form method="dialog"><button class="btn secondary">Close</button></form>
  </dialog>

  <dialog id="dlg-contact" class="legal">
    <h3>Contact</h3>
    <p>Questions? Email: <a href="mailto:hello@psysymbol.com">hello@psysymbol.com</a></p>
    <form method="dialog"><button class="btn secondary">Close</button></form>
  </dialog>

  <!-- Cookie banner for first‑time visitors -->
  <div id="cookieBanner" class="cookie" role="dialog" aria-live="polite">
    <div><b>Ad choices:</b> Personalized, Non‑personalized, or No ads cookies.
      <div class="actions">
        <button id="bannerReject" class="btn secondary">No Ads Cookies</button>
        <button id="bannerNPA" class="btn secondary">Non‑Personalized Ads</button>
        <button id="bannerAccept" class="btn">Personalized Ads</button>
      </div>
    </div>
  </div>

  <script>
    // --- SPA state ---
    const $ = sel => document.querySelector(sel);
    const result = $('#result');
    const query = $('#query');
    const tabs = document.querySelectorAll('.tab');
    const enrichToggle = $('#enrichToggle');
    const autoAdsToggle = $('#autoAdsToggle');
    let mode = 'dream';

    function setMode(m){
      mode = m; tabs.forEach(t=>t.classList.toggle('active', t.dataset.mode===m));
      query.placeholder = m==='dream' ? 'Type your dream…' : m==='symbol' ? 'Type a symbol (e.g. owl)…' : 'Type a number (e.g. 222)…';
      result.classList.add('muted'); result.textContent = 'Enter something above and press Interpret.';
    }
    tabs.forEach(t=> t.addEventListener('click', ()=> setMode(t.dataset.mode)));

    function resetAll(){ setMode('dream'); query.value=''; result.textContent='Enter something above and press Interpret.'; result.classList.add('muted'); location.hash = ''; }
    $('#reset').addEventListener('click', resetAll);
    $('#brandHome').addEventListener('click', resetAll);

    // --- Core interpretation logic (no backend) ---
    function localMeaning(m,q){
      const s = q.trim().toLowerCase();
      if(!s) return 'Please type something first.';
      const dict = {
        dream: { donut: 'Dreaming of a donut can hint at reward, comfort, or a missing center—something sweet with a gap to address.' },
        symbol:{ owl: 'Owls often symbolize wisdom, intuition, and seeing in the dark—insight during confusing times.' },
        number:{ '222': '222 commonly points to balance, cooperation, and staying the course while partnerships align.' }
      };
      return (dict[m] && dict[m][s]) || `Here\'s a general ${m} interpretation for “${q}”: seek balance, context, and personal resonance.`;
    }

    async function enrichMeaning(m,q,base){
      try{
        if(!enrichToggle.checked) return base;
        let extra='';
        if(m==='number'){
          const r=await fetch(`https://numbersapi.com/${encodeURIComponent(q)}/trivia`);
          if(r.ok) extra=await r.text();
        } else {
          const r=await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`);
          if(r.ok){ const j=await r.json(); extra=j.extract||''; }
        }
        return base + (extra ? `\n\n— Web enrichment —\n${extra}` : '');
      }catch(e){ return base + '\n\n(Web enrichment unavailable right now.)'; }
    }

    async function doInterpret(){
      const q = query.value; if(!q.trim()) { result.textContent = 'Please type something first.'; result.classList.remove('muted'); return; }
      result.textContent = 'Thinking…'; result.classList.add('muted');
      const base = localMeaning(mode,q);
      const out = await enrichMeaning(mode,q,base);
      result.textContent = out; result.classList.remove('muted');
    }
    $('#interpret').addEventListener('click', doInterpret);
    query.addEventListener('keydown', e=>{ if(e.key==='Enter') doInterpret(); });

    // --- Modals via hash ---
    const modals = {'#privacy':$('#dlg-privacy'),'#cookie':$('#dlg-cookie'),'#terms':$('#dlg-terms'),'#about':$('#dlg-about'),'#contact':$('#dlg-contact')};
    function onHash(){ Object.values(modals).forEach(d=> d.open && d.close()); const m=modals[location.hash]; if(m) m.showModal(); }
    window.addEventListener('hashchange', onHash); onHash();

    // Footer year & dates
    $('#year').textContent = new Date().getFullYear();
    $('#privacy-date').textContent = new Date().toLocaleDateString();

    // --- Consent & Ads ---
    const CONSENT_KEY='psysymbol-consent-v2';
    function getConsent(){ try{ return JSON.parse(localStorage.getItem(CONSENT_KEY)||'null'); }catch{return null} }
    function setConsent(val){ localStorage.setItem(CONSENT_KEY, JSON.stringify({ val, ts: Date.now() })); }

    function applyConsent(mode){
      // mode: 'personalized' | 'npa' | 'rejected'
      if(mode==='personalized'){
        gtag('consent','update',{'ad_storage':'granted','ad_personalization':'granted','ad_user_data':'granted','analytics_storage':'denied'});
        if(autoAdsToggle.checked){ window.__PSY_ADS__.load({npa:0}); }
      } else if(mode==='npa'){
        gtag('consent','update',{'ad_storage':'granted','ad_personalization':'denied','ad_user_data':'denied','analytics_storage':'denied'});
        if(autoAdsToggle.checked){ window.__PSY_ADS__.load({npa:1}); }
      } else {
        gtag('consent','update',{'ad_storage':'denied','ad_personalization':'denied','ad_user_data':'denied','analytics_storage':'denied'});
        // Do not load AdSense
      }
    }

    function acceptPersonalized(){ setConsent('personalized'); $('#cookieBanner').classList.remove('show'); applyConsent('personalized'); }
    function acceptNPA(){ setConsent('npa'); $('#cookieBanner').classList.remove('show'); applyConsent('npa'); }
    function rejectAds(){ setConsent('rejected'); $('#cookieBanner').classList.remove('show'); applyConsent('rejected'); }

    // Banner buttons
    $('#bannerAccept').addEventListener('click', acceptPersonalized);
    $('#bannerNPA').addEventListener('click', acceptNPA);
    $('#bannerReject').addEventListener('click', rejectAds);
    // Dialog buttons
    $('#cookieAccept').addEventListener('click', acceptPersonalized);
    $('#cookieNPA').addEventListener('click', acceptNPA);
    $('#cookieReject').addEventListener('click', rejectAds);

    // Initial state
    const saved = getConsent();
    if(saved){ applyConsent(saved.val); }
    else { document.getElementById('cookieBanner').classList.add('show'); }

    // Dialog links
    document.getElementById('privacyLink').addEventListener('click', e=>{ e.preventDefault(); location.hash = '#privacy'; });
    document.getElementById('termsLink').addEventListener('click', e=>{ e.preventDefault(); location.hash = '#terms'; });
    document.getElementById('aboutLink').addEventListener('click', e=>{ e.preventDefault(); location.hash = '#about'; });
    document.getElementById('contactLink').addEventListener('click', e=>{ e.preventDefault(); location.hash = '#contact'; });
  </script>
</body>
</html>
